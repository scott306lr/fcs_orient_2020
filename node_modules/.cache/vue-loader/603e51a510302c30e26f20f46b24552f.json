{"remainingRequest":"/home/lr/coding/javascript/fcs_orient_2021/orient_frontend/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/lr/coding/javascript/fcs_orient_2021/orient_frontend/src/components/HintDetails.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/lr/coding/javascript/fcs_orient_2021/orient_frontend/src/components/HintDetails.vue","mtime":1619182842769},{"path":"/home/lr/coding/javascript/fcs_orient_2021/orient_frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lr/coding/javascript/fcs_orient_2021/orient_frontend/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/home/lr/coding/javascript/fcs_orient_2021/orient_frontend/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/lr/coding/javascript/fcs_orient_2021/orient_frontend/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBmaXJlYmFzZSBmcm9tICJmaXJlYmFzZS9hcHAiOwppbXBvcnQgImZpcmViYXNlL2FuYWx5dGljcyI7CmltcG9ydCAiZmlyZWJhc2UvYXV0aCI7CmltcG9ydCAiZmlyZWJhc2UvZmlyZXN0b3JlIjsKaW1wb3J0ICJmaXJlYmFzZS9zdG9yYWdlIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBwcm9wczogewogICAgaWQ6IE51bWJlciwKICAgIHN0YXR1czogU3RyaW5nLAogIH0sCiAgY29tcHV0ZWQ6IHt9LAogIG1vdW50ZWQoKSB7CiAgICB0aGlzLmZldGNoSGludCgpOwogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZ3JvdXBfaWQgPSB0aGlzLiRyb3V0ZS5xdWVyeS5ncm91cDsKICAgIC8vdGhpcy5mZXRjaERhdGEoKTsKICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBoaW50OiBKU09OLAogICAgICBoaW50czogSlNPTiwKICAgICAgZ3JvdXA6IEpTT04sCiAgICAgIGlucHV0X3RleHQ6ICIiLAogICAgICB1cGxvYWRtb2RlOiBmYWxzZSwKICAgICAgaW5wdXRtb2RlOiBmYWxzZSwKICAgICAgZmlsZTogbnVsbCwKICAgIH07CiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBmZXRjaEhpbnQoKSB7CiAgICAgIGNvbnN0IHZhbF9oaW50ID0gYXdhaXQgdGhpcy5heGlvcwogICAgICAgIC5nZXQoIi9iYWNrZW5kL2hpbnQvIiArIHRoaXMuaWQgKyAiLyIpCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICB9KTsKICAgICAgdGhpcy5oaW50ID0gdmFsX2hpbnQ7CiAgICAgIGNvbnNvbGUubG9nKHZhbF9oaW50KTsKICAgICAgaWYgKHZhbF9oaW50LmhpbnRfY2hvaWNlcyAhPSAzKSB7CiAgICAgICAgdGhpcy51cGxvYWRtb2RlID0gdHJ1ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLmlucHV0bW9kZSA9IHRydWU7CiAgICAgIH0KICAgIH0sCgogICAgYXN5bmMgZmV0Y2hIaW50cygpIHsKICAgICAgY29uc3QgdmFsX2hpbnRzID0gYXdhaXQgdGhpcy5heGlvcwogICAgICAgIC5nZXQoIi9iYWNrZW5kL2dyb3Vwc2luZm8vIiArIHRoaXMuZ3JvdXBfaWQgKyAiLyIpCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICB9KTsKICAgICAgdGhpcy5oaW50cyA9IHZhbF9oaW50cy5oaW50czsKICAgIH0sCgogICAgYXN5bmMgZmV0Y2hHcm91cCgpIHsKICAgICAgY29uc3QgdmFsX2dyb3VwID0gYXdhaXQgdGhpcy5heGlvcwogICAgICAgIC5nZXQoIi9iYWNrZW5kL2dyb3Vwcy8iICsgdGhpcy5ncm91cF9pZCArICIvIikKICAgICAgICAudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogICAgICAgIH0pOwogICAgICB0aGlzLmdyb3VwID0gdmFsX2dyb3VwOwogICAgfSwKCiAgICBhc3luYyBoaW50X3NldF9kb25lKGhpbnRfaWQpIHsKICAgICAgdGhpcy5oaW50c1toaW50X2lkXS5kb25lID0gInllcyI7CiAgICAgIGNvbnNvbGUubG9nKGhpbnRfaWQpOwogICAgICBjb25zb2xlLmxvZyh0aGlzLmhpbnRzW2hpbnRfaWRdKTsKCiAgICAgIGF3YWl0IHRoaXMuYXhpb3MKICAgICAgICAucGF0Y2goIi9iYWNrZW5kL2dyb3Vwc2luZm8vIiArIHRoaXMuZ3JvdXBfaWQgKyAiLyIsIHsKICAgICAgICAgIGhpbnRzOiB0aGlzLmhpbnRzLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICB9KTsKICAgIH0sCgogICAgYXN5bmMgYWRkX3Njb3JlKCkgewogICAgICB0aGlzLmdyb3VwWyJzY29yZSJdICs9IHRoaXMuaGludFsic2NvcmUiXTsKICAgICAgYXdhaXQgdGhpcy5heGlvcwogICAgICAgIC5wYXRjaCgiL2JhY2tlbmQvZ3JvdXBzLyIgKyB0aGlzLmdyb3VwX2lkLnRvU3RyaW5nKCkgKyAiLyIsIHsKICAgICAgICAgIHNjb3JlOiB0aGlzLmdyb3VwLnNjb3JlLAogICAgICAgIH0pCiAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTsKICAgICAgICB9KTsKICAgIH0sCgogICAgYXN5bmMgb3Blbl9oaW50cygpIHsKICAgICAgdmFyIGNudCA9IDA7CiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5oaW50cy5sZW5ndGg7ICsraSkgewogICAgICAgIGNudCArPSB0aGlzLmhpbnRzW2ldLmF2YWlsID09PSAibm8iOwogICAgICB9CiAgICAgIE1hdGgubWluKDMsIGNudCk7CiAgICAgIGkgPSAwOwogICAgICB3aGlsZSAoY250ID4gMCkgewogICAgICAgIGkgPSAoaSArIDEpICUgdGhpcy5oaW50cy5sZW5ndGg7CgogICAgICAgIGlmICh0aGlzLmhpbnRzW2ldLmF2YWlsID09PSAibm8iICYmIE1hdGgucmFuZG9tKCkgPiAwLjcpIHsKICAgICAgICAgIHRoaXMuaGludHNbaV0uYXZhaWwgPSAieWVzIjsKICAgICAgICAgIGF3YWl0IHRoaXMuYXhpb3MKICAgICAgICAgICAgLnBhdGNoKCIvYmFja2VuZC9oaW50cy8iICsgdGhpcy5ncm91cF9pZC50b1N0cmluZygpICsgIi8iLCB7CiAgICAgICAgICAgICAgaGludHM6IHRoaXMuaGludHMsCiAgICAgICAgICAgIH0pCiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkgewogICAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhOwogICAgICAgICAgICB9KTsKICAgICAgICAgIGNudCAtPSAxOwogICAgICAgIH0KICAgICAgfQogICAgfSwKCiAgICBhc3luYyBjaGVja0Fuc3dlcihhbnMpIHsKICAgICAgaWYgKGFucyA9PT0gdGhpcy5oaW50WyJhbnN3ZXIiXSkgewogICAgICAgIHRoaXMuZmV0Y2hIaW50cygpOwogICAgICAgIHRoaXMuZmV0Y2hHcm91cCgpOwogICAgICAgIC8vIFNob3cgY2VsZWJyYXRpb25zID8/CiAgICAgICAgYWxlcnQoIui8uOWFpeato+eiuu+8gSIpOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy5oaW50cy5sZW5ndGg7ICsraSkgewogICAgICAgICAgaWYgKAogICAgICAgICAgICB0aGlzLmhpbnRzW2ldLmlkID09PSB0aGlzLmhpbnQuaWQgJiYKICAgICAgICAgICAgdGhpcy5oaW50c1tpXS5kb25lID09PSAibm8iCiAgICAgICAgICApIHsKICAgICAgICAgICAgdGhpcy5oaW50X3NldF9kb25lKGkpOwogICAgICAgICAgICBjb25zb2xlLmxvZyhpKTsKICAgICAgICAgICAgLy90aGlzLmFkZF9zY29yZSgpOwogICAgICAgICAgICAvL2NvbnNvbGUubG9nKGkpOwogICAgICAgICAgICAvL3RoaXMub3Blbl9oaW50cygpOwogICAgICAgICAgICAvL2NvbnNvbGUubG9nKGkpOwogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0gZWxzZSB7CiAgICAgICAgYWxlcnQoIui8uOWFpemMr+iqpO+8gSIpOwogICAgICB9CiAgICB9LAoKICAgIGFzeW5jIHVwbG9hZEltYWdlKCkgewogICAgICBpZiAodGhpcy5maWxlID09IG51bGwpIHsKICAgICAgICBhbGVydCgi6KuL5LiK5YKz54Wn54mH77yBIik7CiAgICAgICAgcmV0dXJuOwogICAgICB9CiAgICAgIAogICAgICBpZiAodGhpcy5maWxlICE9IG51bGwpIHsKICAgICAgICB2YXIgZmlyZWJhc2VDb25maWcgPSB7CiAgICAgICAgICBhcGlLZXk6ICJBSXphU3lERm9weU1FVnQ4TzBNVFg0TXB6ZDdZR0JDSHlKTDJhWjQiLAogICAgICAgICAgYXV0aERvbWFpbjogImZjc29yaWVudDIwMjEuZmlyZWJhc2VhcHAuY29tIiwKICAgICAgICAgIHByb2plY3RJZDogImZjc29yaWVudDIwMjEiLAogICAgICAgICAgc3RvcmFnZUJ1Y2tldDogImZjc29yaWVudDIwMjEuYXBwc3BvdC5jb20iLAogICAgICAgICAgbWVzc2FnaW5nU2VuZGVySWQ6ICI4MTU2NDEyNTI2MTkiLAogICAgICAgICAgYXBwSWQ6ICIxOjgxNTY0MTI1MjYxOTp3ZWI6ZDc5NTY3NmVjOTZmMTQ1Nzc0YzgwZSIsCiAgICAgICAgICBtZWFzdXJlbWVudElkOiAiRy1YSzlLMU5ZR1MzIiwKICAgICAgICB9OwogICAgICAgIC8vIEluaXRpYWxpemUgRmlyZWJhc2UKICAgICAgICBpZiAoIWZpcmViYXNlLmFwcHMubGVuZ3RoKSBmaXJlYmFzZS5pbml0aWFsaXplQXBwKGZpcmViYXNlQ29uZmlnKTsKCiAgICAgICAgZmlyZWJhc2UuYW5hbHl0aWNzKCk7CiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZSgpOwogICAgICAgIHZhciBoaG1tc3MgPQogICAgICAgICAgZGF0ZS5nZXRIb3VycygpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgIjAiKSArCiAgICAgICAgICBkYXRlLmdldE1pbnV0ZXMoKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICIwIikgKwogICAgICAgICAgZGF0ZS5nZXRTZWNvbmRzKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpOwogICAgICAgIHZhciByZSA9IC8oPzpcLihbXi5dKykpPyQvOwogICAgICAgIHZhciBleHQgPSByZS5leGVjKHRoaXMuZmlsZVsibmFtZSJdKVsxXTsKICAgICAgICB2YXIgZmlsZW5hbWUgPSBgZ3JvdXAkeyIiICsgdGhpcy5ncm91cF9pZH1faGludCR7CiAgICAgICAgICAiIiArIHRoaXMuaWQudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpCiAgICAgICAgfV8ke2hobW1zc30uJHtleHR9YDsKICAgICAgICBjb25zb2xlLmxvZyhmaWxlbmFtZSk7CgogICAgICAgIHZhciBpbWFnZVJlZiA9IGZpcmViYXNlLnN0b3JhZ2UoKS5yZWYoKS5jaGlsZChmaWxlbmFtZSk7CiAgICAgICAgaW1hZ2VSZWYucHV0KHRoaXMuZmlsZSkudGhlbigoc25hcHNob3QpID0+IHsKICAgICAgICAgIGNvbnNvbGUubG9nKCJJbWFnZSBVcGxvYWRlZCEiKTsKICAgICAgICB9KTsKICAgICAgICBhbGVydCgi5LiK5YKz5a6M5oiQ77yBIik7CiAgICAgIH0KICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["HintDetails.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+CA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"HintDetails.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <a> {{ group_id }} </a>\n    <b-card\n      bg-variant=\"dark\"\n      text-variant=\"white\"\n      style=\"max-width: 30rem\"\n      class=\"mb-1\"\n    >\n      <b-card-img-lazy :src=\"id + '.jpg'\" alt=\"Image\" bottom></b-card-img-lazy>\n\n      <b-card-body>\n        <b-card-title>{{ hint.name }}</b-card-title>\n        <b-card-sub-title class=\"mb-2\">{{ hint.difficulty }}</b-card-sub-title>\n        <b-card-text>{{ hint.text }}</b-card-text>\n\n        <b-collapse id=\"collapse_upload\" v-model=\"uploadmode\" class=\"mt-2\">\n          <b-form-file accept=\"image/*\" v-model=\"file\"></b-form-file>\n          <b-button @click=\"uploadImage()\">確認</b-button>\n        </b-collapse>\n\n        <b-collapse id=\"collapse_input\" v-model=\"inputmode\" class=\"mt-2\">\n          <b-input-group>\n            <b-form-input\n              v-model=\"input_text\"\n              placeholder=\"請輸入答案\"\n            ></b-form-input>\n\n            <template #append>\n              <b-button @click=\"checkAnswer(input_text)\">確認</b-button>\n            </template>\n          </b-input-group>\n        </b-collapse>\n      </b-card-body>\n    </b-card>\n  </div>\n</template>\n\n<!-- The core Firebase JS SDK is always required and must be listed first -->\n<script src=\"https://www.gstatic.com/firebasejs/8.4.1/firebase-app.js\"></script>\n\n<!-- TODO: Add SDKs for Firebase products that you want to use\n    https://firebase.google.com/docs/web/setup#available-libraries -->\n<script src=\"https://www.gstatic.com/firebasejs/8.4.1/firebase-analytics.js\"></script>\n<script src=\"https://www.gstatic.com/firebasejs/8.4.1/firebase-storage.js\"></script>\n\n<script>\nimport firebase from \"firebase/app\";\nimport \"firebase/analytics\";\nimport \"firebase/auth\";\nimport \"firebase/firestore\";\nimport \"firebase/storage\";\n\nexport default {\n  props: {\n    id: Number,\n    status: String,\n  },\n  computed: {},\n  mounted() {\n    this.fetchHint();\n  },\n  created() {\n    this.group_id = this.$route.query.group;\n    //this.fetchData();\n  },\n  data() {\n    return {\n      hint: JSON,\n      hints: JSON,\n      group: JSON,\n      input_text: \"\",\n      uploadmode: false,\n      inputmode: false,\n      file: null,\n    };\n  },\n  methods: {\n    async fetchHint() {\n      const val_hint = await this.axios\n        .get(\"/backend/hint/\" + this.id + \"/\")\n        .then(function (response) {\n          return response.data;\n        });\n      this.hint = val_hint;\n      console.log(val_hint);\n      if (val_hint.hint_choices != 3) {\n        this.uploadmode = true;\n      } else {\n        this.inputmode = true;\n      }\n    },\n\n    async fetchHints() {\n      const val_hints = await this.axios\n        .get(\"/backend/groupsinfo/\" + this.group_id + \"/\")\n        .then(function (response) {\n          return response.data;\n        });\n      this.hints = val_hints.hints;\n    },\n\n    async fetchGroup() {\n      const val_group = await this.axios\n        .get(\"/backend/groups/\" + this.group_id + \"/\")\n        .then(function (response) {\n          return response.data;\n        });\n      this.group = val_group;\n    },\n\n    async hint_set_done(hint_id) {\n      this.hints[hint_id].done = \"yes\";\n      console.log(hint_id);\n      console.log(this.hints[hint_id]);\n\n      await this.axios\n        .patch(\"/backend/groupsinfo/\" + this.group_id + \"/\", {\n          hints: this.hints,\n        })\n        .then(function (response) {\n          return response.data;\n        });\n    },\n\n    async add_score() {\n      this.group[\"score\"] += this.hint[\"score\"];\n      await this.axios\n        .patch(\"/backend/groups/\" + this.group_id.toString() + \"/\", {\n          score: this.group.score,\n        })\n        .then(function (response) {\n          return response.data;\n        });\n    },\n\n    async open_hints() {\n      var cnt = 0;\n      for (var i = 0; i < this.hints.length; ++i) {\n        cnt += this.hints[i].avail === \"no\";\n      }\n      Math.min(3, cnt);\n      i = 0;\n      while (cnt > 0) {\n        i = (i + 1) % this.hints.length;\n\n        if (this.hints[i].avail === \"no\" && Math.random() > 0.7) {\n          this.hints[i].avail = \"yes\";\n          await this.axios\n            .patch(\"/backend/hints/\" + this.group_id.toString() + \"/\", {\n              hints: this.hints,\n            })\n            .then(function (response) {\n              return response.data;\n            });\n          cnt -= 1;\n        }\n      }\n    },\n\n    async checkAnswer(ans) {\n      if (ans === this.hint[\"answer\"]) {\n        this.fetchHints();\n        this.fetchGroup();\n        // Show celebrations ??\n        alert(\"輸入正確！\");\n        for (var i = 0; i < this.hints.length; ++i) {\n          if (\n            this.hints[i].id === this.hint.id &&\n            this.hints[i].done === \"no\"\n          ) {\n            this.hint_set_done(i);\n            console.log(i);\n            //this.add_score();\n            //console.log(i);\n            //this.open_hints();\n            //console.log(i);\n            break;\n          }\n        }\n      } else {\n        alert(\"輸入錯誤！\");\n      }\n    },\n\n    async uploadImage() {\n      if (this.file == null) {\n        alert(\"請上傳照片！\");\n        return;\n      }\n      \n      if (this.file != null) {\n        var firebaseConfig = {\n          apiKey: \"AIzaSyDFopyMEVt8O0MTX4Mpzd7YGBCHyJL2aZ4\",\n          authDomain: \"fcsorient2021.firebaseapp.com\",\n          projectId: \"fcsorient2021\",\n          storageBucket: \"fcsorient2021.appspot.com\",\n          messagingSenderId: \"815641252619\",\n          appId: \"1:815641252619:web:d795676ec96f145774c80e\",\n          measurementId: \"G-XK9K1NYGS3\",\n        };\n        // Initialize Firebase\n        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);\n\n        firebase.analytics();\n        var date = new Date();\n        var hhmmss =\n          date.getHours().toString().padStart(2, \"0\") +\n          date.getMinutes().toString().padStart(2, \"0\") +\n          date.getSeconds().toString().padStart(2, \"0\");\n        var re = /(?:\\.([^.]+))?$/;\n        var ext = re.exec(this.file[\"name\"])[1];\n        var filename = `group${\"\" + this.group_id}_hint${\n          \"\" + this.id.toString().padStart(2, \"0\")\n        }_${hhmmss}.${ext}`;\n        console.log(filename);\n\n        var imageRef = firebase.storage().ref().child(filename);\n        imageRef.put(this.file).then((snapshot) => {\n          console.log(\"Image Uploaded!\");\n        });\n        alert(\"上傳完成！\");\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n"]}]}